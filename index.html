<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>INSTANT FLOW | Premium</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@700&family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { background-color: #0b1120; color: white; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        #hero-bg { position: relative; height: 80vh; min-height: 520px; background-size: cover; background-position: center top; transition: 1s ease-in-out; }
        .hero-overlay { position: absolute; bottom: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(to bottom, rgba(11, 17, 32, 0) 0%, rgba(11, 17, 32, 1) 95%); }
        .premium-text { font-family: 'Oswald', sans-serif; font-size: clamp(3.2rem, 12vw, 5.5rem); font-weight: 900; line-height: 0.9; text-transform: uppercase; background: linear-gradient(to right, #60a5fa, #a855f7, #ec4899); -webkit-background-clip: text; -webkit-text-fill-color: transparent; filter: drop-shadow(0 0 15px rgba(168, 85, 247, 0.4)); }
        .income-box { background: rgba(168, 85, 247, 0.05); border: 1px solid rgba(168, 85, 247, 0.3); backdrop-filter: blur(10px); border-radius: 24px; padding: 20px; }
        .income-amount { font-family: 'Oswald', sans-serif; font-size: 3rem; background: linear-gradient(to bottom, #60a5fa, #ec4899); -webkit-background-clip: text; -webkit-text-fill-color: transparent; filter: drop-shadow(0 0 10px rgba(96, 165, 250, 0.5)); }
        .reveal { opacity: 0; transform: translateY(30px); transition: 0.8s ease; }
        .reveal.active { opacity: 1; transform: translateY(0); }
        .tab-btn.active { color: #60a5fa; position: relative; }
        .tab-btn.active::after { content: ''; position: absolute; bottom: 0; left: 25%; width: 50%; height: 3px; background: #60a5fa; border-radius: 10px; box-shadow: 0 0 10px #60a5fa; }
        .verify-badge { color: #ffd700; margin-left: 5px; filter: drop-shadow(0 0 5px #ffd700); animation: pulse 1.5s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    </style>
</head>
<body>

    <div id="hero-bg" class="flex flex-col items-center justify-start pt-16">
        <div class="hero-overlay"></div>
        <div class="relative z-10 text-center px-6 w-full max-w-md">
            <h1 class="premium-text mb-2">INSTANT FLOW</h1>
            <p class="text-blue-400 font-bold tracking-[0.3em] text-[10px] uppercase mb-8 opacity-80">Premium Network</p>
            <div id="copy-address" class="bg-white/5 border border-white/10 rounded-2xl p-4 mb-6 active:scale-95 transition-transform cursor-pointer text-left">
                <p class="text-[9px] text-blue-300 font-bold uppercase tracking-widest mb-2 italic">USDT Address (BEP-20)</p>
                <div class="flex items-center justify-between bg-black/40 p-3 rounded-xl">
                    <span id="usdt-addr" class="text-[11px] font-mono truncate mr-2 text-gray-300">Loading...</span>
                    <i class="fa-regular fa-copy text-blue-400"></i>
                </div>
            </div>
            <div class="income-box mb-10">
                <p class="text-[10px] text-purple-300 font-black uppercase tracking-[0.2em] mb-1">Total Community Income</p>
                <div class="income-amount">৳ <span id="total-income">0</span></div>
            </div>
        </div>
    </div>

    <div class="max-w-xl mx-auto relative z-20">
        <div class="bg-white/5 backdrop-blur-3xl rounded-[35px] border border-white/10 min-h-screen">
            <div class="flex text-[11px] font-black tracking-widest border-b border-white/5">
                <button onclick="changeTab('payouts')" id="tab-p" class="tab-btn active flex-1 py-6">RECENT PAYOUTS</button>
                <button onclick="changeTab('leaderboard')" id="tab-l" class="tab-btn flex-1 py-6 text-gray-500">LEADERBOARD</button>
            </div>
            <div id="display-list" class="p-6 space-y-4"></div>
        </div>
    </div>

    <a id="tg-group-link" href="#" target="_blank" class="fixed bottom-8 right-6 z-50 flex items-center bg-[#0088cc] text-white px-5 py-3 rounded-full shadow-lg active:scale-90 transition-all">
        <i class="fa-brands fa-telegram text-2xl mr-2"></i>
        <span class="font-bold text-xs uppercase">Group</span>
    </a>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBZR2QRof05urBBn1yFIZ5G20aoBKm0KFg",
            authDomain: "es-battel.firebaseapp.com",
            databaseURL: "https://es-battel-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "es-battel",
            storageBucket: "es-battel.firebasestorage.app",
            messagingSenderId: "629464601250",
            appId: "1:629464601250:web:d442b01b399f0ccce37dfb"
        };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        function animateValue(id, start, end, duration) {
            let obj = document.getElementById(id);
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                obj.innerHTML = Math.floor(progress * (end - start) + start).toLocaleString();
                if (progress < 1) window.requestAnimationFrame(step);
            };
            window.requestAnimationFrame(step);
        }

        function reveal() {
            document.querySelectorAll(".reveal").forEach(r => {
                if (r.getBoundingClientRect().top < window.innerHeight - 50) r.classList.add("active");
            });
        }
        window.addEventListener("scroll", reveal);

        let activeTab = 'payouts';

        window.changeTab = (t) => {
            activeTab = t;
            document.getElementById('tab-p').classList.toggle('active', t==='payouts');
            document.getElementById('tab-l').classList.toggle('active', t==='leaderboard');
            render();
        };

        function render() {
            const path = activeTab === 'payouts' ? 'payments' : 'users';
            onValue(ref(db, path), (snapshot) => {
                const container = document.getElementById('display-list');
                container.innerHTML = "";
                let items = [];
                snapshot.forEach(child => { items.push(child.val()); });

                // Automatic Ranking Logic
                if(activeTab === 'leaderboard') {
                    items.sort((a,b) => (b.balance || 0) - (a.balance || 0));
                } else {
                    items.reverse(); // Newest payouts first
                }

                items.forEach((d, i) => {
                    const v = d.verified ? '<i class="fa-solid fa-circle-check verify-badge"></i>' : '';
                    const amt = activeTab === 'leaderboard' ? d.balance : d.amount;
                    container.innerHTML += `
                    <div class="reveal flex justify-between items-center bg-white/5 p-5 rounded-2xl border border-white/5">
                        <div class="flex items-center">
                            ${activeTab==='leaderboard'?`<span class='mr-3 text-gray-500 font-black text-xs'>#${i+1}</span>`:''}
                            <div>
                                <div class="text-sm font-bold flex items-center uppercase">${d.name || d.user}${v}</div>
                                <div class="text-[9px] text-gray-500 font-bold uppercase">${d.method || 'Master Member'}</div>
                            </div>
                        </div>
                        <div class="text-blue-400 font-black text-sm">৳ ${amt || 0}</div>
                    </div>`;
                });
                setTimeout(reveal, 100);
            });
        }

        onValue(ref(db, 'settings/hero_image'), s => { document.getElementById('hero-bg').style.backgroundImage = `url('${s.val()}')`; });
        onValue(ref(db, 'settings/total_community_income'), s => animateValue('total-income', 0, s.val() || 0, 2000));
        onValue(ref(db, 'settings/usdt_address'), s => document.getElementById('usdt-addr').innerText = s.val() || "0x00...00");
        onValue(ref(db, 'settings/group_link'), s => document.getElementById('tg-group-link').href = s.val() || "#");
        
        document.getElementById('copy-address').onclick = () => {
            navigator.clipboard.writeText(document.getElementById('usdt-addr').innerText);
            alert("Address Copied!");
        };
        render();
    </script>
</body>
</html>
